University: ITMO University

Faculty: FICT

Course: Network programming

Year: 2022

Group: K34202

Author: Kachmazov Arthur Andreevich

Lab: Lab2

Date of create: 06.12.2022

Date of finished:

**Тема работы:** Развертывание дополнительного CHR, первый сценарий Ansible

**Цель работы:** С помощью Ansible настроить несколько сетевых устройств и собрать информацию о них. Правильно собрать файл Inventory.

**Ход работы:**
1) Настройка второго CHR
На платформе VirtualBox создана вторая машина с CHR. По аналогии с предыдущим роутером, новая машина была подключена к openVPN-сети (Рис. 1) и успешно связывается с облачной машиной (Рис.2).
  
*Рисунок 1* - Второй Микротик. OVPN-клиент
![image](https://user-images.githubusercontent.com/59313334/206262143-26104a20-8af5-42ef-b07a-6aeb67b96525.png)
  
*Рисунок 2* - Второй Микротик. Пинг облака
![image](https://user-images.githubusercontent.com/59313334/206260384-6eff817e-923f-4e6d-aec3-71bfa77216b9.png)

2) Настройка SSH для Ansible
Для работы Ansible необходимо SSH-подключение к управляемым устройствам. Для его настройки требуется дать доступ к SSH-подключению в настройках VirtualBox (Рис. 3), а затем настроить в 
Winbox работу с ключами (Рис. 4)
  
*Рисунок 3* - Настройка сетевого адаптера VB  
![image](https://user-images.githubusercontent.com/59313334/206263798-e1ceae81-7ac9-4548-be7e-7a84993d0c5b.png)
  
*Рисунок 4* - Настройка SSH в WB  
![image](https://user-images.githubusercontent.com/59313334/206264050-aec9e586-aa90-4db6-9bb5-89123db9106e.png)

3) Файл hosts.ini
На облаке для работы Ansible необходим файл конфигурации hosts.ini, хранящий информацию об адресах управляемых машин (Рис. 5). Устройства собраны в группу Routers, и 
для каждого из них создан набор переменных.
  
*Рисунок 5* - hosts.ini  
![image](https://user-images.githubusercontent.com/59313334/206266698-4da5baf4-2e12-4142-93f4-90e124aa86f1.png)
4) Файл playbook.yml
После настройки Ansible создан файл сценария playbook.yml (Рис. 6). Для написания управляющих команд использован модуль `community.routeros.command`, предназначенный
для управления машинами с операционной системой Router OS.  
  
*Рисунок 6* - Файл playbook.yml  
![image](https://user-images.githubusercontent.com/59313334/206270354-a227621c-b1fa-4298-9efb-5433150a1f99.png)  
  
В результате запуска сценария командой `ansible-playbook playbook.yml` был получен вывод в консоль характеристик роутера (Рис. 7).  
  
*Рисунок 7 - Вывод в консоль характеристик  
![image](https://user-images.githubusercontent.com/59313334/206273480-94edbf5c-890e-48cd-beef-ca0c6cfac711.png)
  
Также были выведены ошибки при настройке OSPF, так как для снятия скриншотов команда была запущена повторно (Рис. 8).  

*Рисунок 8* - Вывод результатов выполнения  
![image](https://user-images.githubusercontent.com/59313334/206273846-8b1ae166-505e-438c-beda-5c8ff5d4e3f9.png)

5) Проверка изменений на роутерах
После выполнения сценария Ansible внесённые изменения были проверены на роутерах (Рис. 9). На скриншотах виден созданный в сценарии пользователь.
  
*Рисунок 9* - Новый пользователь  
![image](https://user-images.githubusercontent.com/59313334/206274090-e4becc01-7542-42a7-b9c2-b987ac1cb594.png)
  
Также на роутерах был настроен NTP-клиент для синхронизации времени с выбранным сервером (Рис. 10).  
  
*Рисунок 10* - Настройка NTP  
![image](https://user-images.githubusercontent.com/59313334/206277604-63f87456-de57-4584-991d-4d93cfc04418.png)
  
Далее была проверена выполненная в плэйбуке настройка OSPF (Рис. 11, 12). Настройка выполнена успешно, так как роутеры отображаются друг у друга в списке соседей по сети.  
  
*Рисунок 11* - Проверка OSPF на первом роутере  
![image](https://user-images.githubusercontent.com/59313334/206278570-74395c79-e831-4a7a-b8fc-e698455336b0.png)  
  
*Рисунок 12* - Проверка OSPF на втором роутере  
![image](https://user-images.githubusercontent.com/59313334/206278744-ad7ee6ea-7dbb-49cd-973d-6073cab9f20d.png)

6) Схема сети
На схеме сети (Рис. 13) добавлено OSPF-соединение.  
  
*Риснуок 13* - Схема сети  
![image](https://user-images.githubusercontent.com/59313334/206278966-193b0eba-f8bf-4406-96cd-8edb53f85338.png)


**Вывод**
  
В ходе работы в сеть был добавлен дополнительный роутер. Был изучен инструмент Ansible для удалённой массовой настройки сетевых устройств при помощи написания специальных
сценариев - плэйбуков. Также были изучены новые настройки роутера - NTP-клиент и OSPF.
