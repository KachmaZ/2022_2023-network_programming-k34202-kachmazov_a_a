University: ITMO University

Faculty: FICT

Course: Network programming

Year: 2022

Group: K34202

Author: Kachmazov Arthur Andreevich

Lab: Lab1

Date of create: 20.09.2022

Date of finished:

**Тема работы:** Установка CHR и Ansible, настройка VPN

**Цель работы:** развертывание виртуальной машины с установленной системой контроля конфигураций Ansible и установка CHR в VirtualBox

**Ход работы:**

1) Создана виртуальная машина на облачном сервисе Яндекс.
2) Осуществлено подключение при помощи протокола SSH

![`](https://user-images.githubusercontent.com/59313334/198109201-effff46a-b2fe-4f18-8d4a-30df0042fabc.png)

3) Создана локальная виртуальная машина под управлением RouterOS 7.6

![image](https://user-images.githubusercontent.com/59313334/198109872-eb7b85a1-bbbe-4094-b78a-9bd7b1011153.png)

4) На персональный компьютер установлено приложение Winbox для настройки роутера

5) Для подключения виртуального роутера к Winbox устанавливен сетевой мост между ВМ и ПК

![image](https://user-images.githubusercontent.com/59313334/198110624-c5744ed8-2d36-4d53-b14b-c67670f68f7c.png)

6) На устройстве в облаке устанавливается инструмент Wireguard для формирования ВПН. Для последующего создания интерфейса генерируется пара публичный/приватный ключ.

![3](https://user-images.githubusercontent.com/59313334/198111247-fa4c3aa2-4602-4e84-9f3b-ccbe93d38b17.png)

7) После подключения роутера к Winbox создан wireguard-интерфейс. Он генерирует собственную пару ключей.

![4](https://user-images.githubusercontent.com/59313334/198111390-881ec6f6-31a0-4e09-8199-6a394f990ce8.png)

8) На основе публичного ключа облачного устройства создаётся пир для виртуального подключения роутера по созданному интерфейсу.

![5](https://user-images.githubusercontent.com/59313334/198111818-a8b285e9-8bec-441c-b1f4-5fb7988f706a.png)

9) Для роутера в виртуальной сети присвоен свой адрес.

![6](https://user-images.githubusercontent.com/59313334/198111933-ec2a02a0-e75f-4aba-9642-eec7cf7e6361.png)

10) Также произведена настройка фаервола.

![7](https://user-images.githubusercontent.com/59313334/198112053-391f019b-94dd-4fc9-9506-1c208362b2e3.png)

11) На облачном устройстве создаётся файл конфигурации Wireguard. В нём указываются созданные ранее ключи, адрес устройства в виртуальной сети, а также допустимые подключения

![2](https://user-images.githubusercontent.com/59313334/198112415-4ab23d9c-d42d-4223-8411-fd23d90a0a6d.png)

12) После перезагрузки wireguard с новыми настройками проверяется подключение по виртаульной сети между облаком и роутером

![8](https://user-images.githubusercontent.com/59313334/198112624-81e7b9d2-1121-4fb1-9af1-3001ec68cda1.png)

13) После успешной настройки VPN-туннеля на облачное устройство установлен Ansible

![9](https://user-images.githubusercontent.com/59313334/198112852-241e07ad-d8fc-4a21-aa69-9574dcaea012.png)


В результате получена VPN-сеть по следующей схеме

![image](https://user-images.githubusercontent.com/59313334/198113058-39d81186-d380-48c1-bd6d-b0c845f78e8d.png)

**Вывод:**
В ходе работы удалось настроить VPN-сеть при помощи инструмента Wireguard. Были связаны между собой виртуальная машина с RouterOS, находящейся на персональном 
компьютере, и виртаульная машина с Ubuntu 20, находящейся на облачном сервисе. В работе были задействованы как консольные, так и графические интерфейсы. Последние
крайне повышают удобство работы с такой системой как RouterOS, функционал которой сильно урезан и специфичен ввиду узкой специализации.

